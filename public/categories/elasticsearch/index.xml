<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Elasticsearch on XguoX - 写点 Ruby 糊口饭吃</title>
    <link>https://xguox.me/categories/elasticsearch/</link>
    <description>Recent content in Elasticsearch on XguoX - 写点 Ruby 糊口饭吃</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Tue, 27 Nov 2018 16:01:23 +0800</lastBuildDate>
    
	<atom:link href="https://xguox.me/categories/elasticsearch/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Logstash 的日志输出</title>
      <link>https://xguox.me/elk-logstash-conf.html/</link>
      <pubDate>Tue, 27 Nov 2018 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elk-logstash-conf.html/</guid>
      <description>Logstash 配置文件的 output 加了一句 1 2 stdout { codec =&amp;gt; rubydebug } 本地测试时候看输出用的, 发上去没把这句删掉然后差点把服务器的硬盘撑坏了. =。 = 去掉这句就不在把正常输出</description>
    </item>
    
    <item>
      <title>Elasticsearch 5/6 的 Web UI 管理工具</title>
      <link>https://xguox.me/web-ui-admin-elasticsearch.html/</link>
      <pubDate>Wed, 01 Aug 2018 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/web-ui-admin-elasticsearch.html/</guid>
      <description>许久没仔细使用 Elasticsearch 以后, 发现版本号已经从之前用的 2.X 升级到 6.3, 发布 5 的时候有关注过一会. 之前那堆管理工具打开一看也都好久没更新了, 可能是因为 Site plugins are</description>
    </item>
    
    <item>
      <title>Elasticsearch 5.X(Lucene 6) 的 BM25 相关度算法</title>
      <link>https://xguox.me/how-elasticsearch-5-scoring-with-bm25.html/</link>
      <pubDate>Mon, 19 Dec 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/how-elasticsearch-5-scoring-with-bm25.html/</guid>
      <description>上次写了关于 Elasticsearch 的分数(_score)是怎么计算得出, 不过那是在 Elasticsearch 5.0 以前的版本用的, Elasticsearch 前不久发布了 5.0 版本, 基于 Lucene 6, 默认使用了 BM25 评分算法. BM25 的 BM</description>
    </item>
    
    <item>
      <title>Elasticsearch 的分数(_score)是怎么计算得出</title>
      <link>https://xguox.me/how-elasticsearch-scoring-document.html/</link>
      <pubDate>Fri, 04 Nov 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/how-elasticsearch-scoring-document.html/</guid>
      <description>上次写了关于 Elasticsearch 如何分词索引, 接着继续写 Elasticsearch 怎么计算搜索结果的得分(_score). Elasticsearch 默认是按照文档与查询的相关度(匹配度)的得分倒序返回结果的</description>
    </item>
    
    <item>
      <title>本地用 Vagrant 搭建 Elasticsearch 集群</title>
      <link>https://xguox.me/elasticsearch-build-development-cluster-with-vagrant.html/</link>
      <pubDate>Tue, 27 Sep 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elasticsearch-build-development-cluster-with-vagrant.html/</guid>
      <description>Vagrant 在 Ruby/Rails 社区老早之前就听的挺多的, 但今天才开始尝试折腾. 当前下载的版本是 1.8.5, 虚拟机用的是 VirtualBox 5.1. 一开始尝试用 &amp;lsquo;hashicorp/precise32&amp;rsquo; 这个 box, 但是, 在设置 private_network 的时候貌似有 bug, 1 2</description>
    </item>
    
    <item>
      <title>Elasticsearch 如何不用停机情况下完成 mapping 的修改</title>
      <link>https://xguox.me/elasticsearch-changing-mapping-with-zero-downtime.html/</link>
      <pubDate>Sat, 13 Aug 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elasticsearch-changing-mapping-with-zero-downtime.html/</guid>
      <description>添加新的 fields 可以不需要重新索引 reindex 的背后 真正的 0 downtime 最近使用 searchkick 这个 Gem 才发现, 之前用的 elasticsearch-rails 要更灵(jian)活(lou)的多. 为了让数据可以被查询到,</description>
    </item>
    
    <item>
      <title>Elasticsearch analysis &amp; 自定义 analyzers</title>
      <link>https://xguox.me/elasticsearch-custom-analyzer.html/</link>
      <pubDate>Mon, 01 Aug 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elasticsearch-custom-analyzer.html/</guid>
      <description>当一个 document 被索引时, 通常是对应每个 field 都生成一个倒排索引(Inverted Index)用于作为存储的数据结构, 关于倒排索引, 推荐炮哥之前写的一篇</description>
    </item>
    
    <item>
      <title>Elasticsearch Monitor</title>
      <link>https://xguox.me/elasticsearch-monitor.html/</link>
      <pubDate>Fri, 08 Jul 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elasticsearch-monitor.html/</guid>
      <description>#懒人系列 Elasticsearch 的所有监控管理查询等等操作几乎都可以在命令行里边用 curl 之类的工具完成, 只要记住一大堆形态各异的 url 就可以了. 如果经常用倒还好, 要是不</description>
    </item>
    
    <item>
      <title>Elasticsearch Upstart</title>
      <link>https://xguox.me/elasticsearch-upstart.html/</link>
      <pubDate>Wed, 18 May 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elasticsearch-upstart.html/</guid>
      <description>Elasticsearch(2.3.1) Upstart Script
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  # Elasticsearch Upstart Script description &amp;#34;Elasticsearch upstart script&amp;#34; start on (net-device-up and local-filesystems and runlevel [2345] and startup) stop on runlevel [016] respawn respawn limit 10 30 # NB: Upstart scripts do not respect # /etc/security/limits.</description>
    </item>
    
    <item>
      <title>Elasticsearch Scroll (Ruby)</title>
      <link>https://xguox.me/elasticsearch-scroll.html/</link>
      <pubDate>Sat, 23 Apr 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elasticsearch-scroll.html/</guid>
      <description>Elasticsearch 通过 from 和 size 参数来实现分页. size 表示返回的结果数量, 默认为 10, from 则表示从起始结果算起要跳过的结果数量, 默认为 0. 所以, 默认情况下如果返回结果数是 10</description>
    </item>
    
    <item>
      <title>Upgrade Elasticsearch to 2.3</title>
      <link>https://xguox.me/upgrade-elasticsearch-2-3.html/</link>
      <pubDate>Tue, 12 Apr 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/upgrade-elasticsearch-2-3.html/</guid>
      <description>&lt;p&gt;正式环境和本地一直跑的 1.X, 最近在用 Elasticsearch 的 Aggregations 功能, 发现有一些个语法在 2.X 版本变了, 想来也要跟上潮流了. 于是着手各种升级事宜.&lt;/p&gt;

&lt;p&gt;官方有专门的 &lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/rolling-upgrades.html#upgrade-node&#34;&gt;Rolling upgrades 链接&lt;/a&gt;讲如何升级的, 不过, 对于目前在用的情况来说, 貌似也用不上那么麻烦. 好吧, 其实有点谈不上升级, 感觉像是直接卸载了重装差不多 = . =&lt;/p&gt;

&lt;p&gt;{% highlight ruby %}&lt;/p&gt;

&lt;h1 id=&#34;ubuntu&#34;&gt;Ubuntu&lt;/h1&gt;

&lt;p&gt;sudo service elasticsearch stop
wget &lt;a href=&#34;https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-2.3.1.deb&#34;&gt;https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-2.3.1.deb&lt;/a&gt;
sudo dpkg -P elasticsearch
sudo dpkg -i elasticsearch-2.3.1.deb
sudo service elasticsearch start
{% endhighlight %}&lt;/p&gt;

&lt;p&gt;理论上应该无痛可以跑起来的, 不过, 有一台服务器上, 安装好了以后, Elasticsearch 一直跑不起来
&lt;code&gt;sudo service elasticsearch start&lt;/code&gt; 一直 fail~fail~fail&lt;/p&gt;

&lt;p&gt;elasticsearch.log 又啥也没输出. 折腾了半天才发现原来是 Java 的版本没跟上. 本地的 Java 8 和另一台 Java 7 都没事, 唯独这台, &lt;code&gt;java -version&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;n&#34;&gt;java&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;version&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1.6.0_65&amp;#34;&lt;/span&gt;
&lt;span class=&#34;no&#34;&gt;Java&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;TM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;SE&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;Runtime&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;Environment&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;build&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mo&#34;&gt;0_65&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b14&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;468&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;M4833&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;no&#34;&gt;Java&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;HotSpot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;TM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Bit&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;Server&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;VM&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;build&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;65&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b04&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;468&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mixed&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Elasticsearch 的官方 requirements 说最低是要 Java 7, 像之前一直跑的这个 Java 6 很可能会有各种已知的 bugs, 虽然, 1.X 还是能在这种情况下跑起来, 不过升级到 2.X 就歇菜了.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;升级完以后查看了一下状态&lt;/p&gt;

&lt;p&gt;&lt;code&gt;curl -XGET http://localhost:9200/_cluster/health\?pretty\=true&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;发现一直以来 Elasticsearch 的这个 status 都是黄的, 印象中好像没绿过&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;err&#34;&gt;➜&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;curl&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;XGET&lt;/span&gt; &lt;span class=&#34;ss&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;ss&#34;&gt;localhost&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9200&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_cluster&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;/health\?pretty\=true
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;{
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;cluster_name&amp;#34; : &amp;#34;elasticsearch_xguox&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;status&amp;#34; : &amp;#34;yellow&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;timed_out&amp;#34; : false,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;number_of_nodes&amp;#34; : 1,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;number_of_data_nodes&amp;#34; : 1,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;active_primary_shards&amp;#34; : 6,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;active_shards&amp;#34; : 6,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;relocating_shards&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;initializing_shards&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;unassigned_shards&amp;#34; : 1,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;delayed_unassigned_shards&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;number_of_pending_tasks&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;number_of_in_flight_fetch&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;task_max_waiting_in_queue_millis&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;active_shards_percent_as_number&amp;#34; : 85.71428571428571
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;elasticsearch.yml 配置文件中有一段注释: 修改 &lt;code&gt;index.number_of_replicas: 0&lt;/code&gt; 然后 reindex 就绿了.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Note, that for development on a local machine, with small indices, it usually&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# makes sense to &amp;#34;disable&amp;#34; the distributed features:&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#index.number_of_shards: 1&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#index.number_of_replicas: 0&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# These settings directly affect the performance of index and search operations&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# in your cluster. Assuming you have enough machines to hold shards and&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# replicas, the rule of thumb is:&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# 1. Having more *shards* enhances the _indexing_ performance and allows to&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#    _distribute_ a big index across machines.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# 2. Having more *replicas* enhances the _search_ performance and improves the&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#    cluster _availability_.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# The &amp;#34;number_of_shards&amp;#34; is a one-time setting for an index.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# The &amp;#34;number_of_replicas&amp;#34; can be increased or decreased anytime,&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# by using the Index Update Settings API.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;err&#34;&gt;➜&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;curl&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;XGET&lt;/span&gt; &lt;span class=&#34;ss&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;ss&#34;&gt;localhost&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9200&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_cluster&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;/health\?pretty\=true
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;{
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;cluster_name&amp;#34; : &amp;#34;elasticsearch_xguox&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;status&amp;#34; : &amp;#34;green&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;timed_out&amp;#34; : false,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;number_of_nodes&amp;#34; : 1,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;number_of_data_nodes&amp;#34; : 1,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;active_primary_shards&amp;#34; : 6,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;active_shards&amp;#34; : 6,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;relocating_shards&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;initializing_shards&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;unassigned_shards&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;delayed_unassigned_shards&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;number_of_pending_tasks&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;number_of_in_flight_fetch&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;task_max_waiting_in_queue_millis&amp;#34; : 0,
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;  &amp;#34;active_shards_percent_as_number&amp;#34; : 100.0
&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;还有就是, 查看 elasticsearch.log 的时候经常看到类似这样的信息,&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;n&#34;&gt;high&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;disk&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;watermark&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;90&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;%] exceeded on [VopDVS8uRPurOowYR78xkQ]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Marvel&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;Boy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;/usr/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;/var/e&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lasticsearch&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;/elasticsearch_xguox/no&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;des&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;/0] free: 23gb[9.9%], shards will be relocated away from this node&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;也是在 配置文件 &lt;code&gt;elasticsearch.yml&lt;/code&gt; 添加下面几句就搞定了:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;n&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;routing&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;allocation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;disk&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;threshold_enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;true&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;routing&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;allocation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;disk&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;watermark&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;low&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;97&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;routing&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;allocation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;disk&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;watermark&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;high&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;99&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;hr /&gt;

&lt;p&gt;BTW, 现在都流行飙版本号了?&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://ww4.sinaimg.cn/large/62fdd4d5gw1f2ua8tdd6mj20h80imab9.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;React 直接跳到 15.X, 这&amp;hellip;&lt;/p&gt;

&lt;hr /&gt;</description>
    </item>
    
    <item>
      <title>Elasticsearch Aggregations 聚合分析</title>
      <link>https://xguox.me/elasticsearch-aggregations.html/</link>
      <pubDate>Thu, 31 Mar 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elasticsearch-aggregations.html/</guid>
      <description>Elasticsearch 除了全文搜索以外还有一个主要功能, 就是数据的聚合分析, Aggregations. 有点类似于 SQL 中的 GROUP BY. Elasticsearch 的 Aggregations API 给出了一大堆的用法. 1.X 主要分两类: Bucket Aggregations 和 Metrics Aggregations, 2.X 多了一类</description>
    </item>
    
    <item>
      <title>Elasticsearch More Like This 搜索</title>
      <link>https://xguox.me/elasticsearch-more-like-this.html/</link>
      <pubDate>Mon, 29 Feb 2016 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elasticsearch-more-like-this.html/</guid>
      <description>Elasticsearch 封装好了More Like This 搜索功能, 用来基于给定的某个或某组文档, 返回与之相似的文档. 语法如下: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 { &amp;#34;more_like_this&amp;#34; : { &amp;#34;fields&amp;#34;</description>
    </item>
    
    <item>
      <title>Elasticsearch on Rails</title>
      <link>https://xguox.me/elasticsearch-rails.html/</link>
      <pubDate>Wed, 16 Sep 2015 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elasticsearch-rails.html/</guid>
      <description>上一篇扯了一大通都只是 Elasticsearch 的安装配置, 现在扯点集成到 Rails 上的东西. elasticsearch-rails 这个 Repository 是由三个 Gem 组成, 1 2 3 gem &amp;#39;elasticsearch-model&amp;#39; gem &amp;#39;elasticsearch-rails&amp;#39; gem &amp;#39;elasticsearch-persistence&amp;#39; 总觉得这里起名略蛋疼 = . = 一般用到前</description>
    </item>
    
    <item>
      <title>Elasticsearch 开箱笔记</title>
      <link>https://xguox.me/elasticsearch-ik-mmseg-homebrew-ubuntu.html/</link>
      <pubDate>Mon, 31 Aug 2015 16:01:23 +0800</pubDate>
      
      <guid>https://xguox.me/elasticsearch-ik-mmseg-homebrew-ubuntu.html/</guid>
      <description>和 Solr 一样, Elasticsearch 是一个基于全文搜索引擎 Apache Lucene&amp;trade; 基础上的搜索引擎. 没怎么用 Solr, 所以不好做各方面比较. 而厂里的 CRM 系统用的就是 Elasticsearch. Elasticsearch 不仅可以支持全文搜索, 同时</description>
    </item>
    
  </channel>
</rss>